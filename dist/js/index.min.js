"use strict";function hexDateConvert(e){var o=new Date,r=parseInt(e,16);return r+=25678678,o.setTime(6e4*r),o}function getHexDate(e){var o=Math.floor(e.getTime()/6e4);return(o-=25678678).toString(16)}function glucoseToHex(e){var o="00"+(10*parseFloat(e)).toString(16).substr(-16);return o=o.slice(-3)}function rateToHex(e){var o="0"+(10*parseFloat(e)).toString(16).substr(-16);return o=o.slice(-2)}function hexToFloat(e){return parseInt(e,16)/10}function governance(e){var o=e.split("-");if(2!==o.length)return null;var r=o[1].charAt(0),t=hexDateConvert(o[1].substr(1,o[1].length)),n=null,s=null,a=null;return"a"===r&&(s=hexToFloat(o[0].substr(0,3))),"b"!==r&&"c"!==r||(n=hexToFloat(o[0].substr(0,2)),s=hexToFloat(o[0].substr(2,3)),a=hexToFloat(o[0].substr(5,3))),{function:r,current:s,last:a,rate:n,date:t.toString()}}var dosubmit=function(){var e=document.getElementById("d").value;document.getElementById("r").innerHTML=hexDateConvert(e)},firstFunction=function(e){var o=parseFloat(e),r=!1;return o<=4&&(r="Treat hypoglycaemia according to protocol"),4<o&&o<=10&&(r="No insulin required - recheck 4-6 hourly"),10<o&&o<=12&&(r="Start insulin at 1 unit/hr"),12<o&&o<=15&&(r="Start insulin at 2 units/hr"),15<o&&o<=18&&(r="Start insulin at 3 units/hr"),18<o&&(r="Start insulin at 4 units/hr"),r},secondFunction=function(e,o,r){if(Number.isNaN(e)||Number.isNaN(o)||Number.isNaN(r))return!1;var t="LOGIC ERROR";e<=2.2&&(t="1"),2.3<=e&&e<=4&&(t="2"),4.1<=e&&e<6.1&&o<=6&&(t="3"),4.1<=e&&e<6.1&&6<o&&e-o<-1.5&&(t="2"),4.1<=e&&e<6.1&&6<o&&-1.5<=e-o&&e-o<0&&(t="3"),6.1<=e&&e<8&&o<1.5&&(t="29"),6.1<=e&&e<8&&1.5<o&&(t="53"),(8<=e&&e<10.1||o<8&&10<o)&&(t="10"),8<=e&&e<10.1&&8<=o&&o<=10&&(t="54"),10.1<=e&&e<12.1&&o<=12&&e-o<0&&(t="17"),10.1<=e&&e<12.1&&o<=12&&0<=e-o&&(t="36"),10.1<=e&&e<12.1&&12<o&&e-o<0&&-2<=e-o&&(t="32"),10.1<=e&&e<12.1&&12<o&&e-o<-2&&(t="33"),12.1<=e&&e<=14&&o<12.1&&(t="34"),12.1<=e&&e<=14&&12.1<=o&&o<=14&&0<=e-o&&(t="35"),12.1<=e&&e<=14&&12.2<=o&&o<=14.4&&e-o<0&&-1<=e-o&&(t="35"),12.1<=e&&e<=14&&13.2<=o&&o<=18&&e-o<=-.5&&-3.9<=e-o&&(t="37"),12.1<=e&&e<=14&&16.1<=o&&o<=18&&e-o<=-4&&(t="33"),12.1<=e&&e<=14&&18<o&&(t="33"),14<e&&o<12.1&&(t="38"),14<e&&12.1<=o&&o<=14&&(t="34"),14<e&&14<o&&0<e-o&&(t="38"),14<e&&14<o&&e-o<=0&&-1.9<=e-o&&(t="34"),14<e&&14<o&&e-o<-1.9&&-4<e-o&&(t="18"),14<e&&14<o&&e-o<=-4&&(t="33");var n=-1;return"1"===t&&(n=0),"2"===t&&(n=0),"3"===t&&(n=0),"10"===t&&(n=r*(e/o)),"17"===t&&(n=r),"18"===t&&(n=r),"29"===t&&(n=0),"32"===t&&(n=r),"33"===t&&(n=r*(e/o)),"34"===t&&(n=r+2),"35"===t&&(n=r+1),"36"===t&&(n=r+1),"37"===t&&(n=r),"38"===t&&(n=r+e/o*2),"53"===t&&(n=.5*r),"54"===t&&(n=r),n=Math.round(10*n)/10,result=n+"ml/hr","1"===t&&(result+="<br><br><strong>Additional advice:</strong><br>STOP INSULIN FOR AT LEAST 1 HOUR<br>Follow hypoglycaemia protocol.<br>Give IV dextrose immediately & ensure background nutrition or glucose intake.<br>Recheck blood glucose in 15, 30 and 60 minutes until stable."),"2"===t&&(result+="<br><br><strong>Additional advice:</strong><br>STOP INSULIN FOR AT LEAST 1 HOUR<br>Give IV dextrose immediately if blood glucose < 4mmol/L & ensure background nutrition or glucose intake.<br> If blood glucose is greater than 4mmol/l then it is falling rapidly. Recheck blood glucose in 30 and 60 minutes."),"3"===t&&(result+="<br><br><strong>Additional advice:</strong><br>STOP INSULIN FOR AT LEAST 1 HOUR<br>Ensure background nutrition or glucose intake. Recheck blood glucose in 1 hour."),"10"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 1 hour.<br>If blood glucose has been between 6-10mmol consider 2 hourly blood glucose checks."),"17"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 1 hour. "),"18"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 1-2 hours.<br>(1 hour if drop in blood glucose > 2 mmol/L in last hour)"),"29"===t&&(result+="<br><br><strong>Additional advice:</strong><br>STOP INSULIN FOR AT LEAST 1 HOUR<br>Restart insulin if blood glucose > 10mmol/L"),"32"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 2 hours."),"33"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 1 hour."),"34"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 1 hour."),"35"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 1 hour."),"36"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 2 hours."),"37"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 1 hour."),"38"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 1 hour."),"53"===t&&(result+="<br><br><strong>Additional advice:</strong><br>Recheck blood glucose in 1 hour.<br>Caution as blood glucose is falling and approaching bottom of target range."),"54"===t&&(result+="<br><br><strong>Additional advice:</strong><br>If blood glucose and calorie intake have been stable for last 2 hours move to 2 hourly BG checks. "),result},calc=function(){var e=null,o=parseFloat($("#d2").dropdown("get value")),r=parseFloat($("#d3").dropdown("get value")),t=parseFloat($("#d4").dropdown("get value"));if(console.log("rate = "+t),console.log("current = "+o),console.log("previous = "+r),e=secondFunction(o,r,t)){var n=new Date,s=null;return s=$("#b2").hasClass("teal")?"b":"c",e=e+'<br><br><strong>Calculation reference code (record in casenotes):</strong><br><span id="foo">'+(rateToHex(t)+glucoseToHex(o)+glucoseToHex(r)+"-"+s+getHexDate(n))+"</span>",e+='<br><span id="copyAdvice" data-clipboard-target="#foo">Copy code to clipboard</span>'}return!1};$(document).ready(function(){$(".message .close").on("click",function(){$(this).closest(".message").transition("fade")});var e=new ClipboardJS("#copyAdvice");e.on("success",function(e){console.info("Action:",e.action),console.info("Text:",e.text),console.info("Trigger:",e.trigger),$(".message").show(),e.clearSelection()}),e.on("error",function(e){console.error("Action:",e.action),console.error("Trigger:",e.trigger)}),$.reject({reject:{safari:!1,chrome:!1,firefox:!1,msie:!0,opera:!1,konqueror:!0,unknown:!0}})&&(window.location.href="old.html"),$(".dropdown").dropdown(),$(".checkAgain").click(function(){$("#res").html(""),$("#refCode").val(""),$("#enterCode").show()}),$("#checkButton").click(function(){$(".checkAgain").show(),$("#enterCode").hide();var e=$("#refCode").val(),o=governance(e);if(!o)return $("#res").html("<p>Invalid code entered.<br /><br /></p>"),!1;o.last?$("#res").html("\n                     <p>Code <strong>".concat(e,"</strong> was generated <strong>").concat(o.date,'</strong></p>\n                     <p>The user entered the following data:</p>\n                     <div class="ui secondary segment">\n                     <p>Current blood glucose [mmol/L]: <strong>').concat(o.current,"</strong></p>\n                     <p>Previous blood glucose [mmol/L]: <strong>").concat(o.last,"</strong></p>\n                     <p>Current Insulin rate [ml/hr of 1 iU/ml]: <strong>").concat(o.rate,'</strong></p>\n                     </div>\n                     <p>For these values, the calculator generated the following output:</p>\n                     <div class="ui secondary segment">\n                     <p><strong>New Insulin rate:</strong><br />\n                     ').concat(secondFunction(o.current.toString(),o.last.toString(),o.rate.toString()),"</p>\n                     </div><br>")):o.current?$("#res").html("\n                       <p>Code <strong>".concat(e,"</strong> was generated <strong>").concat(o.date,'</strong></p>\n                       <p>The user entered the following data:</p>\n                       <div class="ui secondary segment">\n                       <p>Current blood glucose [mmol/L]: <strong>').concat(o.current,'</strong></p>\n                       </div>\n                       <p>For these values, the calculator generated the following output:</p>\n                       <div class="ui secondary segment">\n                       <p><strong>New Insulin rate:</strong><br />\n                       ').concat(firstFunction(o.current.toString()),"</p>\n                       </div><br>")):$("#res").html("<p>Invalid code entered.<br /><br /></p>")}),$("#b1").click(function(){$("#b1").removeClass("basic"),$("#b1").addClass("teal"),$("#c1").show(),$("#c2").hide(),$("#b2").removeClass("teal"),$("#b2").addClass("basic"),$("#b3").removeClass("teal"),$("#b3").addClass("basic")}),$("#b2").click(function(){$("#b2").removeClass("basic"),$("#b2").addClass("teal"),$("#c2").show(),$("#c1").hide(),$("#b1").removeClass("teal"),$("#b1").addClass("basic"),$("#b3").removeClass("teal"),$("#b3").addClass("basic")}),$("#b3").click(function(){$("#b3").removeClass("basic"),$("#b3").addClass("teal"),$("#c2").show(),$("#c1").hide(),$("#b1").removeClass("teal"),$("#b1").addClass("basic"),$("#b2").removeClass("teal"),$("#b2").addClass("basic")}),$("#d1").dropdown("setting","onChange",function(){$(".adviceA").html("Please select a blood glucose reading from the dropdown above then click the calculate button")}),$("form").keyup(function(){$(".adviceA").html("Please select a blood glucose reading from the dropdown above then click the calculate button"),$(".adviceB").html("Please select current and previous blood glucose readings and the current insulin rate from the dropdown above then click the calculate button")}),$(".doCalcA").click(function(){var e=parseFloat($("#d1").dropdown("get value"));console.log("BG = "+e);var o=firstFunction(e);if(o){var r=new Date;o=o+'<br><br><strong>Calculation reference code (record in casenotes):</strong><br><span id="foo">'+(glucoseToHex(e)+"-a"+getHexDate(r))+"</span>",o+='<br><span id="copyAdvice" data-clipboard-target="#foo">Copy code to clipboard</span>'}$(".adviceA").html(o)}),$("#d2").dropdown("setting","onChange",function(){$(".adviceB").html("Please select current and previous blood glucose readings and the current insulin rate from the dropdown above then click the calculate button")}),$("#d3").dropdown("setting","onChange",function(){$(".adviceB").html("Please select current and previous blood glucose readings and the current insulin rate from the dropdown above then click the calculate button")}),$("#d4").dropdown("setting","onChange",function(){$(".adviceB").html("Please select current and previous blood glucose readings and the current insulin rate from the dropdown above then click the calculate button")}),$(".doCalc").click(function(){var e=calc();$(".adviceB").html(e)}),$(".resetC").click(function(){$("#frm1").trigger("reset"),$("#frm2").trigger("reset"),$(".ui.form .ui.dropdown").dropdown("restore defaults")})});